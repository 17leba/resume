function Game(){var a=this;this.canvasWidth=canvas.width,this.canvasHeight=canvas.height,this.jsonCells={},this.currentRole="jumper",this.role="boy",this.roleWidth=0,this.roleHeight=0,this.cutDownTime=3,this.entranceBlackRoom=!1,this.fleeBlackRoom=3,this.canvasPresumeHeight=10,this.canvasHalfPersumeHeight=this.canvasPresumeHeight/2,this.pixPerMeter=this.canvasHeight/this.canvasPresumeHeight,this.diceOneAniTime=900,this.diceTwoAniTime=1e3,this.diceOneYStartSpeed=(this.canvasHalfPersumeHeight-.5*Config.GRAVITY_FORCE*Math.pow(this.diceOneAniTime/1e3,2))/(this.diceOneAniTime/1e3),this.diceTwoYStartSpeed=(this.canvasHalfPersumeHeight-.5*Config.GRAVITY_FORCE*Math.pow(this.diceTwoAniTime/1e3,2))/(this.diceTwoAniTime/1e3),this.diceOnePixPerSec=this.canvasWidth/2/(this.diceOneAniTime/1e3)+100,this.diceTwoPixPerSec=this.canvasWidth/2/(this.diceTwoAniTime/1e3),this.diceStopShake=!0,this.mousedown=!1,this.mouseup=!1,this.startShakeOneDice=!1,this.startShakeTwoDice=!1,this.dicesIsHidden=!0,this.diceOneNum=0,this.diceTwoNum=0,this.diceTotal=0,this.slopeAngle=Config.slopeAngle*Config.deg,this.matrixSlope=45*Config.deg-Config.slopeAngle*Config.deg,this.mapRealHorizontal=420*Math.cos(this.matrixSlope)/Math.cos(this.slopeAngle),this.mapRealVertical=this.mapRealHorizontal*Math.tan(this.matrixSlope),this.mapHorizontal=360*Math.cos(this.matrixSlope)/Math.cos(this.slopeAngle),this.mapVertical=this.mapHorizontal*Math.tan(this.matrixSlope),this.walkMapLeft=this.canvasWidth/2-this.mapRealHorizontal,this.walkMapTop=this.canvasHeight/2-this.mapRealVertical,this.horizontalPacePix=Math.floor(this.mapHorizontal/6),this.verticalPacePix=Math.floor(this.mapVertical/6),this.jumperMoveAniTime=300,this.jumperJumpAniTime=(this.jumperMoveAniTime-20)/2,this.jumperGridMeter=this.verticalPacePix*this.canvasHalfPersumeHeight/(this.canvasHeight/2),this.jumperPixEverySec=Math.floor(this.horizontalPacePix/(this.jumperMoveAniTime/1e3)),this.jumperLeftUpSpeed=(2*this.jumperGridMeter+.5*Config.GRAVITY_FORCE*Math.pow(this.jumperJumpAniTime/1e3,2))/(this.jumperJumpAniTime/1e3),this.jumperLeftDownSpeed=(1*this.jumperGridMeter-.5*Config.GRAVITY_FORCE*Math.pow(this.jumperJumpAniTime/1e3,2))/(this.jumperJumpAniTime/1e3),this.jumperRightUpSpeed=(1*this.jumperGridMeter+.5*Config.GRAVITY_FORCE*Math.pow(this.jumperJumpAniTime/1e3,2))/(this.jumperJumpAniTime/1e3),this.jumperRightDownSpeed=(2*this.jumperGridMeter-.5*Config.GRAVITY_FORCE*Math.pow(this.jumperJumpAniTime/1e3,2))/(this.jumperJumpAniTime/1e3),this.runnerAniTime=300,this.runnerHPixEverySec=Math.floor(this.horizontalPacePix/(this.runnerAniTime/1e3)),this.runnerVPixEverySec=this.runnerHPixEverySec*Math.tan(this.matrixSlope),this.roleIsMoving=!1,this.currentPointer=0,this.lastPointer=0,this.pokerSelect=!1,this.shortCutView=!1,this.coverSlideTime=400,this.lastFrameTime=0,this.lastFpsUpdateTime=0,this.pauseGameTag=!1,this.spaceTriggerPause=!1,this.commonFps=60,this.resumeArr=[],this.fpsShow=document.getElementById("fps-show"),this.selectRoleWrap=document.querySelector(".select-role-wrap"),this.gameCutDown=document.querySelector(".game-cutdown"),this.roleListAll=document.querySelectorAll(".role-list"),this.gameCoverWrap=document.querySelector(".game-cover-wrap"),this.gameCover=document.querySelector(".game-cover"),this.precentWrap=document.querySelector(".load-precent-wrap"),this.startGameBtn=document.querySelector(".start-game-btn"),this.gameResumeDetail=document.querySelector(".game-resume-detail"),this.gameResumeWrap=document.querySelector(".game-resume-wrap"),this.gameResumeClose=document.querySelector(".game-resume-close"),this.rollDiceWrap=document.querySelector(".roll-dice-wrap"),this.rollBtn=document.getElementById("roll-dice-btn"),this.rollCountSelect=document.querySelector(".roll-count-select"),this.rollNumShow=document.querySelector(".roll-num-show"),this.miniGameWrap=document.querySelector(".mini-game-wrap"),this.pokerListBack=document.querySelectorAll(".poker-list-back"),this.pokerList=document.querySelectorAll(".poker-list"),this.pokerTipsWrap=document.querySelector(".poker-tips-wrap"),this.gameBlackRoom=document.querySelector(".game-black-room"),this.audioBtn=document.querySelector(".audio-btn"),this.rulesWrap=document.querySelector(".rules-wrap"),this.cutSound=document.getElementById("mp3-cutdown"),this.startSound=document.getElementById("mp3-start"),this.diceSound=document.getElementById("mp3-dice"),this.jumperSound=document.getElementById("mp3-jumper"),this.runnerSound=document.getElementById("mp3-runner"),this.resumeSound=document.getElementById("mp3-resume"),this.diceOnePaintBehaivor={lastAdvance:0,lastAdvanceTime:0,changeFrequencyTime:100,updateAdvance:function(a){a.painter.cellsIndex<6?a.painter.cellsIndex=6:(6===this.lastAdvance&&(this.lastAdvance=0),a.painter.cellsIndex=this.lastAdvance++)},execute:function(b,c,d){if(a.startShakeOneDice){if(b.diceAnimationTimer.isExpired())return a.startShakeOneDice=!1,b.painter.cellsIndex=a.diceOneNum,!1;0===this.lastAdvanceTime&&(this.lastAdvanceTime=d),d-this.lastAdvanceTime>this.changeFrequencyTime--&&(this.updateAdvance(b),this.lastAdvanceTime=d)}}},this.diceOneMoveBehaivor={execute:function(b,c,d){if(b.diceAnimationTimer.isRunning()){var e=1/a.commonFps;b.velocityX=a.diceOnePixPerSec*e,b.velocityY=(a.diceOneYStartSpeed+Config.GRAVITY_FORCE*(b.diceAnimationTimer.getElapsedTime()/1e3))*a.pixPerMeter*e,b.left+=b.velocityX,b.top+=b.velocityY}b.diceAnimationTimer.isExpired()&&b.diceAnimationTimer.stop()}},this.diceOneBehaivor=[this.diceOnePaintBehaivor,this.diceOneMoveBehaivor],this.diceTwoPaintBehaivor={lastAdvance:0,lastAdvanceTime:0,changeFrequencyTime:150,updateAdvance:function(a){a.painter.cellsIndex<6?a.painter.cellsIndex=6:(6===this.lastAdvance&&(this.lastAdvance=0),a.painter.cellsIndex=this.lastAdvance++)},isInBlackRoom:function(){return a.entranceBlackRoom?(a.fleeBlackRoom--,a.fleeBlackRoom&&a.diceOneNum!==a.diceTwoNum?!0:(a.fleeBlackRoom=3,a.entranceBlackRoom=!1,!1)):!1},roleStartMove:function(){a.currentRunnerLoc(),a.roleIsAction=!1,a.roleIsMoving=!0,"runner"===a.currentRole?a.runner.runTimer.start():(a.jumper.jumpTimer.start(),a.jumper.moveTimer.start())},execute:function(b,c,d){var e=this;if(a.startShakeTwoDice){if(b.diceAnimationTimer.isExpired()){if(a.startShakeTwoDice=!1,b.painter.cellsIndex=a.diceTwoNum,a.diceNumShow(a.diceTotal),this.isInBlackRoom())return a.rollDiceShow(!0),void setTimeout(function(){a.diceLocReset()},500);var f=setTimeout(function(){a.pauseGameTag?setTimeout(arguments.callee,200):(e.roleStartMove(),a.diceLocReset(),clearTimeout(f))},800);return!1}0===this.lastAdvanceTime&&(this.lastAdvanceTime=d),d-this.lastAdvanceTime>(this.changeFrequencyTime-=2)&&(this.updateAdvance(b),this.lastAdvanceTime=d)}}},this.diceTwoMoveBehaivor={execute:function(b,c,d){if(b.diceAnimationTimer.isRunning()){a.diceStopShake=!1;var e=1/a.commonFps;b.velocityX=a.diceTwoPixPerSec*e,b.velocityY=(a.diceTwoYStartSpeed+Config.GRAVITY_FORCE*(b.diceAnimationTimer.getElapsedTime()/1e3))*a.pixPerMeter*e,b.left+=b.velocityX,b.top+=b.velocityY}b.diceAnimationTimer.isExpired()&&(a.diceStopShake=!0,b.diceAnimationTimer.stop())}},this.diceTwoBehaivor=[this.diceTwoPaintBehaivor,this.diceTwoMoveBehaivor],this.jumperJumpFallBehavior={direction:"up",distanceTopGap:0,originTop:0,verticalAmend:function(b){this.distanceTopGap=(Math.abs(b.top-this.originTop)-a.verticalPacePix).toFixed(2)-0,this.originTop=0,this.distanceTopGap<0?a.currentPointer>12&&a.currentPointer<25?b.top-=this.distanceTopGap:b.top+=this.distanceTopGap:a.currentPointer>12&&a.currentPointer<25?b.top-=this.distanceTopGap:b.top+=this.distanceTopGap},jumpDirection:function(){a.currentPointer>12&&a.currentPointer<25?(this.direction="down",this.jumperVerticalUpSpeed=a.jumperRightUpSpeed,this.jumperVerticalDownSpeed=a.jumperRightDownSpeed):(this.direction="up",this.jumperVerticalUpSpeed=a.jumperLeftUpSpeed,this.jumperVerticalDownSpeed=a.jumperLeftDownSpeed)},execute:function(b,c,d){if(a.roleIsMoving){this.originTop||(this.originTop=b.top);var e=1/a.commonFps;b.jumpTimer.isRunning()?(this.jumpDirection(),b.velocityY=(this.jumperVerticalUpSpeed-Config.GRAVITY_FORCE*(b.jumpTimer.getElapsedTime()/1e3))*a.pixPerMeter*e,b.top-=b.velocityY,b.jumpTimer.isExpired()&&(b.jumpTimer.stop(),b.fallTimer.start())):b.fallTimer.isRunning()&&(b.velocityY=(this.jumperVerticalDownSpeed+Config.GRAVITY_FORCE*(b.fallTimer.getElapsedTime()/1e3))*a.pixPerMeter*e,b.top+=b.velocityY,b.fallTimer.isExpired()&&(a.jumperFallEnd=!0,this.verticalAmend(b)))}}},this.jumperMoveBehavior={distanceLeftGap:0,originLeft:0,peakAmend:function(b){12===a.currentPointer&&(a.jumper.top=a.rolesHalfTop,a.jumper.left=a.rolesHalfLeft),24===a.currentPointer&&(a.jumper.top=a.rolesInitialTop,a.jumper.left=a.rolesInitialLeft)},horizontalAmend:function(b){this.distanceLeftGap=(Math.abs(b.left-this.originLeft)-a.horizontalPacePix).toFixed(2)-0,this.originLeft=0,this.distanceLeftGap>0?a.currentPointer>6&&a.currentPointer<19?b.left-=this.distanceLeftGap:b.left+=this.distanceLeftGap:a.currentPointer>6&&a.currentPointer<19?b.left+=this.distanceLeftGap:b.left-=this.distanceLeftGap},execute:function(b,c,d){if(a.roleIsMoving){if(this.originLeft||(this.originLeft=b.left),b.moveTimer.isRunning()){var e=1/a.commonFps;b.velocityX=a.jumperPixEverySec*e,a.currentPointer>6&&a.currentPointer<19?b.left+=b.velocityX:b.left-=b.velocityX}b.moveTimer.isExpired()&&(a.jumperMoveEnd=!0),a.jumperFallEnd&&a.jumperMoveEnd&&(a.jumperFallEnd=!1,a.jumperMoveEnd=!1,this.peakAmend(b),this.horizontalAmend(b),--a.diceTotal?(a.currentRunnerLoc(),a.playSound(a.jumperSound),b.jumpTimer.start(),b.moveTimer.start()):(b.fallTimer.stop(),b.moveTimer.stop(),a.roleIsMoving=!1,a.roleIsAction=!0,a.showResult(a.currentPointer)))}}},this.jumperActionBehavior={lastAdvanceTime:0,changeFrequencyTime:250,execute:function(b,c,d){a.roleIsAction&&(0===this.lastAdvanceTime&&(this.lastAdvanceTime=d),d-this.lastAdvanceTime>this.changeFrequencyTime&&(b.painter.advance(),this.lastAdvanceTime=d))}},this.jumperBehavior=[this.jumperJumpFallBehavior,this.jumperMoveBehavior,this.jumperActionBehavior],this.runnerActionBehavior={lastAdvanceTime:0,changeFrequencyTime:100,updateAdvance:function(b){var c=a.currentPointer,d=b.painter.cellsIndex;switch(!0){case c>=0&&6>c&&d>=3:b.painter.cellsIndex=0;break;case c>=6&&12>c&&d>=7:b.painter.cellsIndex=4;break;case c>=12&&18>c&&d>=11:b.painter.cellsIndex=8;break;case c>=18&&24>c&&d>=15:b.painter.cellsIndex=12}},execute:function(b,c,d){a.roleIsMoving&&(0===this.lastAdvanceTime&&(this.lastAdvanceTime=d),d-this.lastAdvanceTime>this.changeFrequencyTime&&(b.painter.advance(),this.updateAdvance(b),this.lastAdvanceTime=d))}},this.runnerMoveBehavior={execute:function(b,c,d){if(a.roleIsMoving){if(b.runTimer.isRunning()){var e=1/a.commonFps;b.velocityX=a.runnerHPixEverySec*e,b.velocityY=a.runnerVPixEverySec*e,a.currentPointer>6&&a.currentPointer<19?b.left+=b.velocityX:b.left-=b.velocityX,a.currentPointer>0&&a.currentPointer<13?b.top-=b.velocityY:b.top+=b.velocityY}b.runTimer.isExpired()&&(24===a.currentPointer&&(a.runner.top=a.rolesInitialTop,a.runner.left=a.rolesInitialLeft),--a.diceTotal?(a.currentRunnerLoc(),a.playSound(a.runnerSound),b.runTimer.start()):(b.runTimer.stop(),a.roleIsMoving=!1,a.showResult(a.currentPointer)))}}},this.runnerBehavior=[this.runnerActionBehavior,this.runnerMoveBehavior]}Game.prototype={start:function(){var a=this;this.showStartBtn(),this.showSelectRole(),this.audioToggle(),this.selectRole(function(){a.coverAni(a.selectRoleWrap,-a.canvasHeight,a.coverSlideTime,gameEasing.easeIn,function(){document.body.removeChild(a.gameCoverWrap),a.cutDown(a.cutDownTime,function(){a.startGame()})})})},startGame:function(){var a=this;this.showRules(),this.playSound(this.startSound),this.confirmRoleWH(),this.pauseGame(),this.createResumeLoc(),this.rollDiceShow(!0),this.createSprites(),this.startShakeDice(),this.closeResume(),this.windowFocus(),window.requestAnimationFrame(function(b){a.animate.call(a,b)})},animate:function(a){var b=this;this.pauseGameTag?(this.togglePauseTimer(),setTimeout(function(){window.requestAnimationFrame(function(a){b.animate.call(b,a)})},200)):(this.togglePauseTimer(),this.commonFps=this.fps(a),this.drawSprites(a),window.requestAnimationFrame(function(a){b.animate.call(b,a)}))},showStartBtn:function(){this.gameCover.removeChild(this.precentWrap),this.startGameBtn.className="start-game-btn"},togglePauseTimer:function(){var a=this.diceOne.diceAnimationTimer,b=this.diceTwo.diceAnimationTimer,c=this.runner.runTimer,d=this.jumper.jumpTimer,e=this.jumper.fallTimer,f=this.jumper.moveTimer;this.pauseGameTag&&!a.isPause()&&(a.pause(),b.pause(),d.pause(),f.pause(),e.pause(),c.pause()),!this.pauseGameTag&&a.isPause()&&(a.unpause(),b.unpause(),d.unpause(),f.unpause(),e.unpause(),c.unpause())},startShakeDice:function(){var a,b,c=this,d="right";this.rollBtn.addEventListener("mousedown",function(e){c.mousedown||c.pauseGameTag||(c.mousedown=!0,a=setInterval(function(){b=c.rollCountSelect.style.width,b=b?parseInt(b):0,c.rollCountSelect.style.width="left"===d?b-10+"px":b+10+"px",b>=190?d="left":0>=b&&(d="right")},16))},!1),this.rollBtn.addEventListener("mouseout",function(a){if(c.mousedown&&!c.pauseGameTag){var b=document.createEvent("HTMLEvents");b.initEvent("mouseup",!0,!1),this.dispatchEvent(b)}},!1),this.rollBtn.addEventListener("mouseup",function(){c.mouseup||c.pauseGameTag||(c.mouseup=!0,clearInterval(a),c.playSound(c.diceSound),c.convertRoll(b),c.diceDetailNum(c.diceTotal),c.rollDiceShow(),c.lastRunnerLoc(),c.diceStartRotate())},!1)},rollDiceShow:function(a){var b=this;setTimeout(function(){a?b.rollDiceWrap.style.display="block":(b.mousedown=!1,b.mouseup=!1,b.rollCountSelect.style.width=0,b.rollDiceWrap.style.display="none")},200)},diceNumShow:function(a){var b=this;setTimeout(function(){b.rollNumShow.innerHTML=a},500),setTimeout(function(){b.rollNumShow.innerHTML=""},1500)},diceDetailNum:function(a){var b=a-2;this.diceOneNum=b>5?this.intervalRandom(b-5,5):this.intervalRandom(0,b),this.diceTwoNum=b-this.diceOneNum},convertRoll:function(a){switch(!0){case 50>=a:this.diceTotal=this.intervalRandom(2,3);break;case a>50&&100>=a:this.diceTotal=this.intervalRandom(3,6);break;case a>100&&150>=a:this.diceTotal=this.intervalRandom(6,9);break;case a>150&&200>=a:this.diceTotal=this.intervalRandom(9,12)}},intervalRandom:function(a,b){var c=b-a+1;return Math.floor(Math.random()*c+a)},diceStartRotate:function(){this.dicesIsHidden=!1,this.startShakeOneDice=!0,this.startShakeTwoDice=!0,this.diceOne.diceAnimationTimer.start(),this.diceTwo.diceAnimationTimer.start()},diceLocReset:function(){this.diceOne.left=-96,this.diceTwo.left=-96,this.diceOne.top=-96,this.diceTwo.top=-96,this.startShakeOneDice=!1,this.startShakeTwoDice=!1,this.dicesIsHidden=!0},cutDown:function(a,b){for(var c,d=a,e=this.gameCutDown,f=this,g=0;a>=g;g++)!function(g){c=setTimeout(function(){return g===a?(clearTimeout(c),e.className="game-cutdown hide",b(),!1):(f.playSound(f.cutSound),e.className="game-cutdown game-cutdown-"+d,void d--)},1e3*g)}(g)},drawSprites:function(a){context.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.drawDice(a),this.updateRoles(a)},createSprites:function(){this.drawElements(),this.createDice(),this.createRoles(),this.offScreenCanvasBg()},createDice:function(){this.diceOne=new Sprite("diceThree",new SpriteSheets(Config.imgSource[0],this.findCellData("diceThree",Config.jsonObj.main)),this.diceOneBehaivor),this.diceTwo=new Sprite("diceTwo",new SpriteSheets(Config.imgSource[0],this.findCellData("diceTwo",Config.jsonObj.main)),this.diceTwoBehaivor),this.diceOne.diceAnimationTimer=new AnimationTimer(this.diceOneAniTime),this.diceTwo.diceAnimationTimer=new AnimationTimer(this.diceTwoAniTime),this.diceLocReset()},createRoles:function(){this.jumper=new Sprite("jumper",new SpriteSheets(Config.imgSource[2],this.findCellData(this.role,Config.jsonObj.jumpers)),this.jumperBehavior),this.jumper.top=this.rolesInitialTop,this.jumper.left=this.rolesInitialLeft,this.jumper.jumpTimer=new AnimationTimer(this.jumperJumpAniTime),this.jumper.fallTimer=new AnimationTimer(this.jumperJumpAniTime),this.jumper.moveTimer=new AnimationTimer(this.jumperMoveAniTime),this.runner=new Sprite("runner",new SpriteSheets(Config.imgSource[3],this.findCellData(this.role,Config.jsonObj.runners)),this.runnerBehavior),this.runner.left=this.rolesInitialLeft,this.runner.top=this.rolesInitialTop,this.runner.runTimer=new AnimationTimer(this.runnerAniTime)},drawDice:function(a){this.dicesIsHidden||(this.diceOne.paint(context),this.diceOne.update(context,a),this.diceTwo.paint(context),this.diceTwo.update(context,a))},drawWalkMap:function(){var a=(new Sprite("map-block",new drawStaticImage(Config.imgSource[0],Config.jsonObj.main["map-block-left"])),new Sprite("map-block",new drawStaticImage(Config.imgSource[0],Config.jsonObj.main["map-block-top"])),new Sprite("map-block",new drawStaticImage(Config.imgSource[0],Config.jsonObj.main["map-block-bottom"]))),b=new Sprite("map-block",new drawStaticImage(Config.imgSource[0],Config.jsonObj.main["map-block-right"])),c=new Sprite("map-block",new drawStaticImage(Config.imgSource[0],Config.jsonObj.main["block-blue"])),d=new Sprite("map-block",new drawStaticImage(Config.imgSource[0],Config.jsonObj.main["block-red"])),e=new Sprite("map-block",new drawStaticImage(Config.imgSource[0],Config.jsonObj.main["block-grey"])),f=new Sprite("map-block",new drawStaticImage(Config.imgSource[0],Config.jsonObj.main["block-white"])),g=new Sprite("map-block",new drawStaticImage(Config.imgSource[0],Config.jsonObj.main["block-green"])),h=new Sprite("map-block",new drawStaticImage(Config.imgSource[0],Config.jsonObj.main["block-wblue"])),i=new Sprite("map-block",new drawStaticImage(Config.imgSource[0],Config.jsonObj.main["block-black"])),j=new Sprite("map-block",new drawStaticImage(Config.imgSource[0],Config.jsonObj.main["map-block-top-corner"]));this.mapOffCanvas=document.createElement("canvas"),this.mapOffContext=this.mapOffCanvas.getContext("2d"),this.mapOffCanvas.width=2*this.mapRealHorizontal,this.mapOffCanvas.height=2*this.mapRealVertical,this.mapOffContext.save(),this.mapOffContext.translate(this.mapRealHorizontal,0),this.mapOffContext.rotate(45*Config.deg),this.mapOffContext.transform(1,-Math.tan(this.slopeAngle),-Math.tan(this.slopeAngle),1,0,0);for(var k=0;24>k;k++)switch(!0){case 0===k:g.top=360,g.left=360,g.paint(this.mapOffContext);break;case 2===k:e.top=360,e.left=240,e.paint(this.mapOffContext);break;case 6===k:i.left=0,i.top=360,i.paint(this.mapOffContext);break;case 12===k:j.top=0,j.left=0,j.paint(this.mapOffContext);break;case 6>k:c.top=360,a.top=360,-1!==this.resumeArr.indexOf(k)?(c.left=60*(6-k),c.paint(this.mapOffContext)):(a.left=60*(6-k),a.paint(this.mapOffContext));break;case k>6&&12>k:d.left=0,b.left=0,-1!==this.resumeArr.indexOf(k)?(d.top=60*(12-k),d.paint(this.mapOffContext)):(b.top=60*(12-k),b.paint(this.mapOffContext));break;case k>12&&18>k:f.top=0,a.top=0,-1!==this.resumeArr.indexOf(k)?(f.left=60*(k-12),f.paint(this.mapOffContext)):(a.left=60*(k-12),a.paint(this.mapOffContext));break;case k>=18&&24>k:h.left=360,b.left=360,-1!==this.resumeArr.indexOf(k)?(h.top=60*(k-18),h.paint(this.mapOffContext)):(b.top=60*(k-18),b.paint(this.mapOffContext))}this.mapOffContext.restore()},drawEnclosure:function(){var a=new Sprite("enclosure-horizontal",new drawStaticImage(Config.imgSource[1],Config.jsonObj.embellish["enclosure-horizontal"])),b=new Sprite("enclosure-vertical",new drawStaticImage(Config.imgSource[1],Config.jsonObj.embellish["enclosure-vertical"]));this.enclosureVOffCanvas=document.createElement("canvas"),this.enclosureVOffContext=this.enclosureVOffCanvas.getContext("2d"),this.enclosureVOffCanvas.width=15,this.enclosureVOffCanvas.height=680;for(var c=0;4>c;c++)b.top=170*c,b.paint(this.enclosureVOffContext);this.enclosureHOffCanvas=document.createElement("canvas"),this.enclosureHOffContext=this.enclosureHOffCanvas.getContext("2d"),this.enclosureHOffCanvas.width=1056,this.enclosureHOffCanvas.height=30;for(var c=0;8>c;c++)a.left=132*c+11,a.paint(this.enclosureHOffContext)},drawTrees:function(){var a=new Sprite("tree1",new drawStaticImage(Config.imgSource[1],Config.jsonObj.embellish["tree-1"])),b=new Sprite("tree2",new drawStaticImage(Config.imgSource[1],Config.jsonObj.embellish["tree-2"]));this.tree1OffCanvas=document.createElement("canvas"),this.tree1OffContext=this.tree1OffCanvas.getContext("2d"),this.tree1OffCanvas.width=129,this.tree1OffCanvas.height=124,a.paint(this.tree1OffContext),this.tree2OffCanvas=document.createElement("canvas"),this.tree2OffContext=this.tree2OffCanvas.getContext("2d"),this.tree2OffCanvas.width=160,this.tree2OffCanvas.height=65;for(var c=0;2>c;c++)b.left=95*c,b.paint(this.tree2OffContext)},drawTent:function(){var a=new Sprite("tent",new drawStaticImage(Config.imgSource[1],Config.jsonObj.embellish.tent));this.tentOffCanvas=document.createElement("canvas"),this.tentOffContext=this.tentOffCanvas.getContext("2d"),this.tentOffCanvas.width=148,this.tentOffCanvas.height=159,a.paint(this.tentOffContext)},drawFireWood:function(){var a=new Sprite("firewood",new drawStaticImage(Config.imgSource[1],Config.jsonObj.embellish.firewood));this.firewoodOffCanvas=document.createElement("canvas"),this.firewoodOffContext=this.firewoodOffCanvas.getContext("2d"),this.firewoodOffCanvas.width=96,this.firewoodOffCanvas.height=32;for(var b=0;2>b;b++)a.left=64*b,a.paint(this.firewoodOffContext)},drawCask:function(){var a=new Sprite("cask",new drawStaticImage(Config.imgSource[1],Config.jsonObj.embellish.cask));this.caskOffCanvas=document.createElement("canvas"),this.caskOffContext=this.caskOffCanvas.getContext("2d"),this.caskOffCanvas.width=120,this.caskOffCanvas.height=45;for(var b=0;2>b;b++)a.left=60*b,a.paint(this.caskOffContext)},drawChair:function(){var a=new Sprite("chair",new drawStaticImage(Config.imgSource[1],Config.jsonObj.embellish.chair));this.chairOffCanvas=document.createElement("canvas"),this.chairOffContext=this.chairOffCanvas.getContext("2d"),this.chairOffCanvas.width=128,this.chairOffCanvas.height=64,a.paint(this.chairOffContext)},updateRoles:function(a){"jumper"===this.currentRole?this.drawJumper(a):this.drawRunner(a)},drawJumper:function(a){this.jumper.paint(context),(this.roleIsMoving||this.roleIsAction)&&this.jumper.update(context,a)},drawRunner:function(a){this.runner.paint(context),this.roleIsMoving&&this.runner.update(context,a)},drawElements:function(){this.drawWalkMap(),this.drawEnclosure(),this.drawTrees(),this.drawTent(),this.drawFireWood(),this.drawCask(),this.drawChair()},offScreenCanvasBg:function(){canvasBgContext.drawImage(this.mapOffCanvas,this.walkMapLeft,this.walkMapTop),canvasBgContext.drawImage(this.enclosureVOffCanvas,0,0),canvasBgContext.drawImage(this.enclosureVOffCanvas,this.canvasWidth-15,0),canvasBgContext.drawImage(this.enclosureHOffCanvas,0,0),canvasBgContext.drawImage(this.enclosureHOffCanvas,0,this.canvasHeight-30),canvasBgContext.drawImage(this.tree1OffCanvas,0,0),canvasBgContext.drawImage(this.tree2OffCanvas,this.canvasWidth-190,this.canvasHeight-120),canvasBgContext.drawImage(this.tentOffCanvas,this.canvasWidth-160,0),canvasBgContext.drawImage(this.firewoodOffCanvas,this.canvasWidth-128,160),canvasBgContext.drawImage(this.caskOffCanvas,60,120),canvasBgContext.drawImage(this.chairOffCanvas,50,400)},selectRole:function(a){for(var b=this.roleListAll,c=b.length,d=this,e=0;c>e;e++)!function(c){b[c].addEventListener("click",function(){d.role=this.dataset.role,d.currentRole="runner"===d.role?"runner":"jumper",a()},!1)}(e)},showSelectRole:function(){var a=this;this.startGameBtn.addEventListener("click",function(b){b.preventDefault(),a.coverAni(a.gameCover,-a.canvasHeight,a.coverSlideTime,gameEasing.easeOut,function(){a.gameCoverWrap.removeChild(a.gameCover),console.log("please select role!!")})},!1)},confirmRoleWH:function(){"runner"===this.role?(this.roleWidth=55,this.roleHeight=80):(this.roleWidth=150,this.roleHeight=150),this.rolesInitialLeft=this.canvasWidth/2-this.roleWidth/2,this.rolesInitialTop=this.walkMapTop+2*this.mapRealVertical-this.roleHeight-this.verticalPacePix,this.rolesHalfLeft=this.rolesInitialLeft,this.rolesHalfTop=this.rolesInitialTop-2*this.mapVertical},showBlackRoom:function(){var a=this;this.entranceBlackRoom=!0,setTimeout(function(){a.gameBlackRoom.className="game-black-room zoomIn animated",a.gameBlackRoom.innerHTML="你真不幸，被关小黑屋啦！想逃离的话，有两种途径：<br />（1）连续掷三次后，自动解除锁定。<br />（2）掷的骰子数相同则自动解除。"},500),setTimeout(function(){a.gameBlackRoom.className="game-black-room hide",a.rollDiceShow(!0)},4500)},showMiniGame:function(){this.miniGameWrap.className="mini-game-wrap zoomIn animated";for(var a=this.pokerList.length,b=["two","three","four","five"],c=this,d=0;a>d;d++)this.pokerList[d].className+=" "+b[Math.floor(4*Math.random())];for(var e=0;a>e;e++)!function(a){c.pokerListBack[a].addEventListener("click",function(){if(!c.pokerSelect){c.pokerSelect=!0;var b=Math.floor(3*Math.random());c.pokerList[b].className="poker-list one",this.className+=" rollOver180",c.pokerList[a].className+=" rollOver0",c.showShortCut(a===b?"success":"fail")}},!1)}(e)},showShortCut:function(a){var b=this;setTimeout(function(){b.pokerTipsWrap.className="poker-tips-wrap zoomIn animated",b.pokerTipsWrap.innerHTML="正在加载...","success"===a?b.showResume("shortCutKey",Config.resumeJson.shortCutKey,function(a){b.shortCutShowResume(),b.pokerTipsWrap.innerHTML=a.info},!0):b.pokerTipsWrap.innerHTML="你猜错啦,手气不佳呀，下次再来吧！"},500),setTimeout(function(){b.rollDiceShow(!0),b.pokerSelect=!1,b.miniGameWrap.className="mini-game-wrap hide",b.pokerTipsWrap.className="poker-tips-wrap hide";for(var a=0;3>a;a++)b.pokerListBack[a].className="poker-list-back",b.pokerList[a].className="poker-list"},3500)},showResult:function(a){var b=this;switch(a){case this.resumeArr[0]:this.showResume("personalInfo",Config.resumeJson.personalInfo,function(a){b.resumeOne.call(b,a)});break;case this.resumeArr[1]:this.showResume("contact",Config.resumeJson.contact,function(a){b.resumeTwo.call(b,a)});break;case this.resumeArr[2]:this.showResume("blog-works",Config.resumeJson.blog,function(a){b.resumeThree.call(b,a)});break;case this.resumeArr[3]:this.showResume("experience",Config.resumeJson.experience,function(a){b.resumeFour.call(b,a)});break;case 2:this.showMiniGame();break;case 6:this.showBlackRoom();break;default:this.rollDiceShow(!0)}},shortCutShowResume:function(){var a=this;document.addEventListener("keydown",function(b){if(!a.shortCutView){a.shortCutView=!0;var c=b.keyCode;switch(c){case 89:a.showResume("personalInfo",Config.resumeJson.personalInfo,function(b){a.resumeOne.call(a,b)});break;case 80:a.showResume("contact",Config.resumeJson.contact,function(b){a.resumeTwo.call(a,b)});break;case 66:a.showResume("blog-works",Config.resumeJson.blog,function(b){a.resumeThree.call(a,b)});break;case 78:a.showResume("experience",Config.resumeJson.experience,function(b){a.resumeFour.call(a,b)});break;default:a.shortCutView=!1}}},!1)},showResume:function(a,b,c,d){var e=this;d||(this.gameResumeDetail.className="game-resume-detail zoomIn animated",this.gameResumeWrap.className="game-resume-wrap loading",this.playSound(this.resumeSound));var f=new XMLHttpRequest||new ActiveXObject("Microsoft.XMLHTTP");f.onreadystatechange=function(){if(4===f.readyState&&(e.gameResumeWrap.className="game-resume-wrap",200===f.status)){var a=JSON.parse(f.responseText);c(a)}},f.open("GET",b,!0),f.setRequestHeader("Content-Type","application/json"),f.send(null)},resumeOne:function(a){var b="<h2>"+a.title+"</h2><p>姓名："+a.name+"</p><p>性别："+a.gender+"</p><p>出生日期："+a.birth+"</p><p>学历："+a.education+"<p>居住地："+a.location+"</p><p>现在所在公司："+a.company+"</p><p>前端开发经验："+a.experience+"</p>";this.gameResumeWrap.innerHTML=b},resumeTwo:function(a){var b="<h2>"+a.title+"</h2><p>手机："+a.mobile+"</p><p>Email："+a.email+"</p><p>QQ："+a.qq+"</p>";this.gameResumeWrap.innerHTML=b},resumeThree:function(a){var b="<h2>"+a.title+'</h2><p>博客：<a href="'+a.blog+'" target="_blank">点击</a></p><p>GitHub：<a href="'+a.github+'" target="_blank">点击</a></p><p>jQuery解析：<a href="'+a["jquery-analysis"]+'" target="_blank">点击</a></p><p>本游戏源码：<a href="'+a["resume-game"]+'" target="_blank">点击</a></p><p>HTML5微信页面：<a href="'+a.H5.start+'" target="_blank">WIFI大作战</a><a href="'+a.H5.jiju+'" target="_blank">发布会邀请函</a><a href="'+a.H5.six+'" target="_blank">六脉神剑</a></p><p>PC网站：<a href="'+a.web.jly+'" target="_blank">点击</a></p><p>其它：'+a.soon+"</p>";this.gameResumeWrap.innerHTML=b},resumeFour:function(a){var b="<h2>"+a.title+'</h2><div class="game-work-exp">'+a.info+"</div>";this.gameResumeWrap.innerHTML=b},closeResume:function(){var a=this;this.gameResumeClose.addEventListener("click",function(){a.shortCutView=!1,a.rollDiceShow(!0),this.parentNode.className="game-resume-detail hide",a.gameResumeWrap.innerHTML=""},!1)},soundIsPlaying:function(a){return!a.ended&&a.currentTime>0},playSound:function(a){this.pauseAudioTag||(this.soundIsPlaying(a)?(a.load(),a.play()):a.play())},audioToggle:function(){var a=this;this.audioBtn.addEventListener("click",function(){a.pauseAudioTag=!a.pauseAudioTag,a.pauseAudioTag?this.classList.add("close"):this.classList.remove("close")},!1)},findCellData:function(a,b){var c=[];for(var d in b)-1!==d.indexOf(a)&&c.push(b[d]);return this.jsonCells[a]=c,c},currentRunnerLoc:function(){this.currentPointer++,25===this.currentPointer&&(this.currentPointer=1)},lastRunnerLoc:function(){this.lastPointer=25!==this.lastPointer?this.lastPointer+this.diceTotal:1},createResumeLoc:function(){for(var a,b=0;4>b;b++)a=Math.floor(24*Math.random()),a%6===0&&a++,-1===this.resumeArr.indexOf(a)&&2!==a?this.resumeArr.push(a):b--},fps:function(a){var b;return b=this.lastFrameTime?1e3/(a-this.lastFrameTime):60,this.lastFrameTime=a,a-this.lastFpsUpdateTime>1e3&&(this.fpsShow.innerHTML=b.toFixed(0)+" fps",this.lastFpsUpdateTime=a),b},pauseGame:function(){var a=this;document.addEventListener("keydown",function(b){var c=b.keyCode;32===c&&(a.spaceTriggerPause=!a.spaceTriggerPause,a.togglePaused())})},togglePaused:function(){var a=+new Date;this.pauseGameTag=!this.pauseGameTag,this.pauseGameTag?this.pauseStartTime=a:this.lastFrameTime+=a-this.pauseStartTime},windowFocus:function(){var a=this;a.spaceTriggerPause||(window.onblur=function(){this.windowHasFocus=!1,a.pauseGameTag||a.togglePaused()},window.onfocus=function(){this.windowHasFocus=!0;var b;a.pauseGameTag&&(b=a.roleIsMoving||!a.diceStopShake?2:0,a.cutDown(b,function(){a.togglePaused()}))})},coverAni:function(a,b,c,d,e){var f,g=a.style.top?parseInt(a.style.top):0,h=16,i=1,b=parseInt(b),j=Math.abs(b-g),k=j/(c/h);f=setInterval(function(){var b=(a.style.top?parseInt(a.style.top):0,k*i/j),c=g-k*i*(d(b)/b);return a.style.top=c+"px",i++,b>=1?(clearInterval(f),void e.call(a)):void 0},h)},showRules:function(){var a=this;this.rulesWrap.classList.add("position"),this.rulesWrap.querySelector(".rules-close-btn").addEventListener("click",function(){document.querySelector(".canvas-main").removeChild(a.rulesWrap)},!1)}};var gameEasing={liner:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2},easeInOut:function(a){return a-Math.sin(2*a*Math.PI)/(2*Math.PI)},easeOut:function(a){return 1-Math.pow(1-a,2)},easeIn:function(a){return Math.pow(a,2)}};window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){setTimeout(a,1e3/60)}}();