function Game(){var a=this;this.canvasWidth=canvas.width,this.canvasHeight=canvas.height,this.jsonCells={},this.currentRole="jumper",this.role="boy",this.roleWidth=0,this.roleHeight=0,this.roleActionStart=!0,this.cutDownTime=3,this.entranceBlackRoom=!1,this.fleeBlackRoom=3,this.canvasPresumeHeight=10,this.canvasHalfPersumeHeight=this.canvasPresumeHeight/2,this.pixPerMeter=this.canvasHeight/this.canvasPresumeHeight,this.diceOneAniTime=900,this.diceTwoAniTime=1e3,this.diceOneYStartSpeed=(this.canvasHalfPersumeHeight-.5*Config.GRAVITY_FORCE*Math.pow(this.diceOneAniTime/1e3,2))/(this.diceOneAniTime/1e3),this.diceTwoYStartSpeed=(this.canvasHalfPersumeHeight-.5*Config.GRAVITY_FORCE*Math.pow(this.diceTwoAniTime/1e3,2))/(this.diceTwoAniTime/1e3),this.diceOnePixPerSec=this.canvasWidth/2/(this.diceOneAniTime/1e3)+100,this.diceTwoPixPerSec=this.canvasWidth/2/(this.diceTwoAniTime/1e3),this.oneEndRotate=!1,this.twoEndRotate=!1,this.mousedown=!1,this.mouseup=!1,this.startShakeOneDice=!1,this.startShakeTwoDice=!1,this.diceOneNum=0,this.diceTwoNum=0,this.diceTotal=0,this.allRunning=!1,this.slopeAngle=Config.slopeAngle*Config.deg,this.matrixSlope=45*Config.deg-Config.slopeAngle*Config.deg,this.mapRealHorizontal=420*Math.cos(this.matrixSlope)/Math.cos(this.slopeAngle),this.mapRealVertical=this.mapRealHorizontal*Math.tan(this.matrixSlope),this.mapHorizontal=360*Math.cos(this.matrixSlope)/Math.cos(this.slopeAngle),this.mapVertical=this.mapHorizontal*Math.tan(this.matrixSlope),this.walkMapLeft=this.canvasWidth/2-this.mapRealHorizontal,this.walkMapTop=this.canvasHeight/2-this.mapRealVertical,this.horizontalPacePix=Math.floor(this.mapHorizontal/6),this.verticalPacePix=Math.floor(this.mapVertical/6),this.jumperMoveAniTime=300,this.jumperJumpAniTime=this.jumperMoveAniTime/2,this.jumperGridMeter=this.verticalPacePix*this.canvasHalfPersumeHeight/(this.canvasHeight/2),this.jumperPixEverySec=Math.floor(this.horizontalPacePix/(this.jumperMoveAniTime/1e3)),this.jumperLeftUpSpeed=(2*this.jumperGridMeter+.5*Config.GRAVITY_FORCE*Math.pow(this.jumperJumpAniTime/1e3,2))/(this.jumperJumpAniTime/1e3),this.jumperLeftDownSpeed=(1.1*this.jumperGridMeter-.5*Config.GRAVITY_FORCE*Math.pow(this.jumperJumpAniTime/1e3,2))/(this.jumperJumpAniTime/1e3),this.jumperRightUpSpeed=(1*this.jumperGridMeter+.5*Config.GRAVITY_FORCE*Math.pow(this.jumperJumpAniTime/1e3,2))/(this.jumperJumpAniTime/1e3),this.jumperRightDownSpeed=(2.3*this.jumperGridMeter-.5*Config.GRAVITY_FORCE*Math.pow(this.jumperJumpAniTime/1e3,2))/(this.jumperJumpAniTime/1e3),this.runnerAniTime=300,this.runnerHPixEverySec=Math.floor(this.horizontalPacePix/(this.runnerAniTime/1e3)),this.runnerVPixEverySec=this.runnerHPixEverySec*Math.tan(this.matrixSlope),this.startJump=!1,this.startMoveAll=!1,this.startMovePer=!1,this.running=!1,this.jumping=!1,this.endRun=!1,this.currentPointer=0,this.lastPointer=0,this.pokerSelect=!1,this.shortCutView=!1,this.fpsShow=document.getElementById("fps-show"),this.selectRoleWrap=document.querySelector(".select-role-wrap"),this.gameCutDown=document.querySelector(".game-cutdown"),this.roleListAll=document.querySelectorAll(".role-list"),this.gameCoverWrap=document.querySelector(".game-cover-wrap"),this.gameCover=document.querySelector(".game-cover"),this.startGameBtn=document.querySelector(".start-game-btn"),this.gameResumeDetail=document.querySelector(".game-resume-detail"),this.gameResumeWrap=document.querySelector(".game-resume-wrap"),this.gameResumeClose=document.querySelector(".game-resume-close"),this.rollDiceWrap=document.querySelector(".roll-dice-wrap"),this.rollBtn=document.getElementById("roll-dice-btn"),this.rollCountSelect=document.querySelector(".roll-count-select"),this.rollNumShow=document.querySelector(".roll-num-show"),this.miniGameWrap=document.querySelector(".mini-game-wrap"),this.pokerListBack=document.querySelectorAll(".poker-list-back"),this.pokerList=document.querySelectorAll(".poker-list"),this.pokerTipsWrap=document.querySelector(".poker-tips-wrap"),this.gameBlackRoom=document.querySelector(".game-black-room"),this.cutSound=document.getElementById("mp3-cutdown"),this.startSound=document.getElementById("mp3-start"),this.diceSound=document.getElementById("mp3-dice"),this.jumperSound=document.getElementById("mp3-jumper"),this.runnerSound=document.getElementById("mp3-runner"),this.resumeSound=document.getElementById("mp3-resume"),this.coverSlideTime=400,this.lastFrameTime=0,this.pauseGameTag=!1,this.commonFps=60,this.resumeArr=[],this.diceOnePaintBehaivor={lastAdvance:0,lastAdvanceTime:0,changeFrequencyTime:100,updateAdvance:function(a){a.painter.cellsIndex<6?a.painter.cellsIndex=6:(6===this.lastAdvance&&(this.lastAdvance=0),a.painter.cellsIndex=this.lastAdvance++)},execute:function(b,c,d){if(a.startShakeOneDice){if(b.diceAnimationTimer.isExpired())return a.startShakeOneDice=!1,b.painter.cellsIndex=a.diceOneNum,!1;0===this.lastAdvanceTime&&(this.lastAdvanceTime=d),d-this.lastAdvanceTime>this.changeFrequencyTime--&&(this.updateAdvance(b),this.lastAdvanceTime=d)}}},this.diceOneMoveBehaivor={execute:function(b){if(b.diceAnimationTimer.isRunning()){var c=1/a.commonFps;b.velocityX=a.diceOnePixPerSec*c,b.velocityY=(a.diceOneYStartSpeed+Config.GRAVITY_FORCE*(b.diceAnimationTimer.getElapsedTime()/1e3))*a.pixPerMeter*c,b.left+=b.velocityX,b.top+=b.velocityY}b.diceAnimationTimer.isExpired()&&b.diceAnimationTimer.stop()}},this.diceOneBehaivor=[this.diceOnePaintBehaivor,this.diceOneMoveBehaivor],this.diceTwoPaintBehaivor={lastAdvance:0,lastAdvanceTime:0,changeFrequencyTime:150,updateAdvance:function(a){a.painter.cellsIndex<6?a.painter.cellsIndex=6:(6===this.lastAdvance&&(this.lastAdvance=0),a.painter.cellsIndex=this.lastAdvance++)},isInBlackRoom:function(){return a.entranceBlackRoom?(a.fleeBlackRoom--,a.fleeBlackRoom&&a.diceOneNum!==a.diceTwoNum?!0:(a.fleeBlackRoom=3,a.entranceBlackRoom=!1,!1)):!1},startJumpMove:function(){a.currentRunnerLoc(),"runner"===a.currentRole?a.runner.runTimer.start():(a.startJump=!0,a.jumper.jumpTimer.start(),a.jumper.moveTimer.start()),a.startMoveAll=!0},execute:function(b,c,d){var e=this;if(a.startShakeTwoDice){if(b.diceAnimationTimer.isExpired()){if(a.startShakeTwoDice=!1,b.painter.cellsIndex=a.diceTwoNum,a.diceNumShow(a.diceTotal),this.isInBlackRoom())return a.rollDiceShow(!0),void setTimeout(function(){a.diceLocReset()},500);var f=setTimeout(function(){e.startJumpMove(),a.diceLocReset(),clearTimeout(f)},800);return!1}0===this.lastAdvanceTime&&(this.lastAdvanceTime=d),d-this.lastAdvanceTime>(this.changeFrequencyTime-=2)&&(this.updateAdvance(b),this.lastAdvanceTime=d)}}},this.diceTwoMoveBehaivor={execute:function(b){if(b.diceAnimationTimer.isRunning()){var c=1/a.commonFps;b.velocityX=a.diceTwoPixPerSec*c,b.velocityY=(a.diceTwoYStartSpeed+Config.GRAVITY_FORCE*(b.diceAnimationTimer.getElapsedTime()/1e3))*a.pixPerMeter*c,b.left+=b.velocityX,b.top+=b.velocityY}b.diceAnimationTimer.isExpired()&&b.diceAnimationTimer.stop()}},this.diceTwoBehaivor=[this.diceTwoPaintBehaivor,this.diceTwoMoveBehaivor],this.jumperJumpFallBehavior={direction:"up",runnerVerticalSpeed:0,jumpDirection:function(){a.currentPointer>12&&a.currentPointer<25?(this.direction="down",this.jumperVerticalUpSpeed=a.jumperRightUpSpeed,this.jumperVerticalDownSpeed=a.jumperRightDownSpeed):(this.direction="up",this.jumperVerticalUpSpeed=a.jumperLeftUpSpeed,this.jumperVerticalDownSpeed=a.jumperLeftDownSpeed)},execute:function(b){if(a.startJump)if(b.jumpTimer.isRunning())if(this.jumpDirection(),b.jumpTimer.isExpired())b.jumpTimer.stop(),b.fallTimer.start();else{var c=1/a.commonFps;b.velocityY=(this.jumperVerticalUpSpeed-Config.GRAVITY_FORCE*(b.jumpTimer.getElapsedTime()/1e3))*a.pixPerMeter*c,b.top-=b.velocityY}else if(b.fallTimer.isRunning())if(b.fallTimer.isExpired()||a.startMovePer)a.startMovePer=!1,a.startMoveAll?b.jumpTimer.start():(b.fallTimer.stop(),a.startJump=!1);else{var c=1/a.commonFps;b.velocityY=(this.jumperVerticalDownSpeed+Config.GRAVITY_FORCE*(b.fallTimer.getElapsedTime()/1e3))*a.pixPerMeter*c,b.top+=b.velocityY}}},this.jumperMoveBehavior={distanceGap:0,originLeft:0,execute:function(b){if(a.startMoveAll){if(a.roleActionStart=!1,this.originLeft||(this.originLeft=b.left),b.moveTimer.isRunning()){var c=1/a.commonFps;b.velocityX=a.jumperPixEverySec*c,a.currentPointer>6&&a.currentPointer<19?b.left+=b.velocityX:b.left-=b.velocityX,this.distanceGap=Math.abs(b.left-this.originLeft)-a.horizontalPacePix,this.distanceGap>0&&(this.originLeft=0,a.currentPointer>6&&a.currentPointer<19?b.left-=this.distanceGap:b.left+=this.distanceGap)}b.moveTimer.isExpired()&&(12===a.currentPointer&&(a.jumper.top=a.rolesHalfTop,a.jumper.left=a.rolesHalfLeft),24===a.currentPointer&&(a.jumper.top=a.rolesInitialTop,a.jumper.left=a.rolesInitialLeft),a.startMovePer=!0,--a.diceTotal?(a.currentRunnerLoc(),a.playSound(a.jumperSound),b.moveTimer.start()):(b.moveTimer.stop(),a.startMoveAll=!1,a.roleActionStart=!0,a.showResult(a.currentPointer)))}}},this.jumperActionBehavior={lastAdvanceTime:0,changeFrequencyTime:250,execute:function(b,c,d){a.roleActionStart&&(0===this.lastAdvanceTime&&(this.lastAdvanceTime=d),d-this.lastAdvanceTime>this.changeFrequencyTime&&(b.painter.advance(),this.lastAdvanceTime=d))}},this.jumperBehavior=[this.jumperJumpFallBehavior,this.jumperMoveBehavior,this.jumperActionBehavior],this.runnerRunActionBehavior={lastAdvanceTime:0,changeFrequencyTime:100,updateAdvance:function(b){a.currentPointer>=0&&a.currentPointer<6&&b.painter.cellsIndex>=3&&(b.painter.cellsIndex=0),a.currentPointer>=6&&a.currentPointer<12&&b.painter.cellsIndex>=7&&(b.painter.cellsIndex=4),a.currentPointer>=12&&a.currentPointer<18&&b.painter.cellsIndex>=11&&(b.painter.cellsIndex=8),a.currentPointer>=18&&a.currentPointer<24&&b.painter.cellsIndex>=15&&(b.painter.cellsIndex=12)},execute:function(b,c,d){a.startMoveAll&&(a.roleActionStart=!1,0===this.lastAdvanceTime&&(this.lastAdvanceTime=d),d-this.lastAdvanceTime>this.changeFrequencyTime&&(b.painter.advance(),this.updateAdvance(b),this.lastAdvanceTime=d))}},this.runnerMoveBehavior={execute:function(b){if(a.startMoveAll){if(a.roleActionStart=!1,b.runTimer.isRunning()){var c=1/a.commonFps;b.velocityX=a.runnerHPixEverySec*c,b.velocityY=a.runnerVPixEverySec*c,a.currentPointer>6&&a.currentPointer<19?b.left+=b.velocityX:b.left-=b.velocityX,a.currentPointer>0&&a.currentPointer<13?b.top-=b.velocityY:b.top+=b.velocityY}b.runTimer.isExpired()&&(24===a.currentPointer&&(a.runner.top=a.rolesInitialTop,a.runner.left=a.rolesInitialLeft),--a.diceTotal?(a.currentRunnerLoc(),a.playSound(a.runnerSound),b.runTimer.start()):(b.runTimer.stop(),a.startMoveAll=!1,a.runnerActionStart=!0,a.showResult(a.currentPointer)))}}},this.runnerBehavior=[this.runnerRunActionBehavior,this.runnerMoveBehavior]}Game.prototype={start:function(){var a=this;this.showSelectRole(),this.selectRole(function(){a.coverAni(a.selectRoleWrap,-560,a.coverSlideTime,gameEasing.easeIn,function(){document.body.removeChild(a.gameCoverWrap),a.cutDown(a.cutDownTime,function(){a.startGame()})})})},startGame:function(){var a=this;this.playSound(this.startSound),this.confirmRoleWH(),this.pauseGame(),this.createResumeLoc(),this.rollDiceShow(!0),this.createSprites(),this.startShakeDice(),this.closeResume(),this.showFps(),this.windowFocus(),window.requestAnimationFrame(function(b){a.animate.call(a,b)})},animate:function(a){var b=this;this.pauseGameTag?setTimeout(function(){window.requestAnimationFrame(function(a){b.animate.call(b,a)})},100):(this.commonFps=this.fps(a),this.drawSprites(a),window.requestAnimationFrame(function(a){b.animate.call(b,a)}))},startShakeDice:function(){var a,b,c=this,d="right";this.rollBtn.addEventListener("mousedown",function(){c.mousedown||c.pauseGameTag||(c.mousedown=!0,a=setInterval(function(){b=c.rollCountSelect.style.width?c.rollCountSelect.style.width:0,b=parseInt(b),c.rollCountSelect.style.width="left"===d?b-10+"px":b+10+"px",b>=190?d="left":0>=b&&(d="right")},16))},!1),this.rollBtn.addEventListener("mouseup",function(){c.mouseup||c.pauseGameTag||(c.mouseup=!0,clearInterval(a),c.playSound(c.diceSound),c.convertRoll(b),c.diceRotateReset(),c.diceDetailNum(c.diceTotal),c.rollDiceShow(),c.lastRunnerLoc(),c.diceStartRotate())},!1)},rollDiceShow:function(a){var b=this;setTimeout(function(){a?b.rollDiceWrap.style.display="block":(b.mousedown=!1,b.mouseup=!1,b.rollCountSelect.style.width=0,b.rollDiceWrap.style.display="none")},200)},diceNumShow:function(a){var b=this;setTimeout(function(){b.rollNumShow.innerHTML=a},500),setTimeout(function(){b.rollNumShow.innerHTML=""},1500)},diceDetailNum:function(a){var b=a-2;this.diceOneNum=b>5?this.intervalRandom(b-5,5):this.intervalRandom(0,b),this.diceTwoNum=b-this.diceOneNum},convertRoll:function(a){50>=a?this.diceTotal=this.intervalRandom(2,3):a>50&&100>=a?this.diceTotal=this.intervalRandom(3,6):a>100&&150>=a?this.diceTotal=this.intervalRandom(6,9):a>150&&200>=a&&(this.diceTotal=this.intervalRandom(9,12))},intervalRandom:function(a,b){var c=b-a+1;return Math.floor(Math.random()*c+a)},diceStartRotate:function(){this.startShakeOneDice=!0,this.startShakeTwoDice=!0,this.diceOne.diceAnimationTimer.start(),this.diceTwo.diceAnimationTimer.start()},diceLocReset:function(){this.diceOne.left=-96,this.diceTwo.left=-96,this.diceOne.top=-96,this.diceTwo.top=-96},diceRotateReset:function(){this.oneEndRotate=!1,this.twoEndRotate=!1},cutDown:function(a,b){for(var c,d=a,e=this.gameCutDown,f=this,g=0;a>=g;g++)!function(g){c=setTimeout(function(){return g===a?(clearTimeout(c),e.className="game-cutdown hide",b(),!1):(f.playSound(f.cutSound),e.className="game-cutdown game-cutdown-"+d,void d--)},1e3*g)}(g)},drawSprites:function(a){context.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.drawDice(a),this.updateRoles(a)},createSprites:function(){this.drawElements(),this.createRoles(),this.createDice(),this.offScreenCanvasBg()},createDice:function(){this.diceOne=new Sprite("diceThree",new SpriteSheets(Config.imgSource[0],this.findCellData("diceThree",Config.jsonObj.main)),this.diceOneBehaivor),this.diceTwo=new Sprite("diceTwo",new SpriteSheets(Config.imgSource[0],this.findCellData("diceTwo",Config.jsonObj.main)),this.diceTwoBehaivor),this.diceOne.diceAnimationTimer=new AnimationTimer(this.diceOneAniTime),this.diceTwo.diceAnimationTimer=new AnimationTimer(this.diceTwoAniTime),this.diceLocReset()},createRoles:function(){this.jumper=new Sprite("jumper",new SpriteSheets(Config.imgSource[2],this.findCellData(this.role,Config.jsonObj.jumpers)),this.jumperBehavior),this.jumper.top=this.rolesInitialTop,this.jumper.left=this.rolesInitialLeft,this.jumper.jumpTimer=new AnimationTimer(this.jumperJumpAniTime),this.jumper.fallTimer=new AnimationTimer(this.jumperJumpAniTime),this.jumper.moveTimer=new AnimationTimer(this.jumperMoveAniTime),this.runner=new Sprite("runner",new SpriteSheets(Config.imgSource[3],this.findCellData(this.role,Config.jsonObj.runners)),this.runnerBehavior),this.runner.left=this.rolesInitialLeft,this.runner.top=this.rolesInitialTop,this.runner.runTimer=new AnimationTimer(this.runnerAniTime)},drawDice:function(a){this.diceOne.paint(context),this.diceOne.update(context,a),this.diceTwo.paint(context),this.diceTwo.update(context,a)},drawWalkMap:function(){var a=(new Sprite("map-block",new drawStaticImage(Config.imgSource[0],Config.jsonObj.main["map-block-left.png"])),new Sprite("map-block",new drawStaticImage(Config.imgSource[0],Config.jsonObj.main["map-block-top.png"])),new Sprite("map-block",new drawStaticImage(Config.imgSource[0],Config.jsonObj.main["map-block-bottom.png"]))),b=new Sprite("map-block",new drawStaticImage(Config.imgSource[0],Config.jsonObj.main["map-block-right.png"])),c=new Sprite("map-block",new drawStaticImage(Config.imgSource[0],Config.jsonObj.main["block-blue.png"])),d=new Sprite("map-block",new drawStaticImage(Config.imgSource[0],Config.jsonObj.main["block-red.png"])),e=new Sprite("map-block",new drawStaticImage(Config.imgSource[0],Config.jsonObj.main["block-grey.png"])),f=new Sprite("map-block",new drawStaticImage(Config.imgSource[0],Config.jsonObj.main["block-white.png"])),g=new Sprite("map-block",new drawStaticImage(Config.imgSource[0],Config.jsonObj.main["block-green.png"])),h=new Sprite("map-block",new drawStaticImage(Config.imgSource[0],Config.jsonObj.main["block-wblue.png"])),i=new Sprite("map-block",new drawStaticImage(Config.imgSource[0],Config.jsonObj.main["block-black.png"])),j=new Sprite("map-block",new drawStaticImage(Config.imgSource[0],Config.jsonObj.main["map-block-top-corner.png"]));this.mapOffCanvas=document.createElement("canvas"),this.mapOffContext=this.mapOffCanvas.getContext("2d"),this.mapOffCanvas.width=2*this.mapRealHorizontal,this.mapOffCanvas.height=2*this.mapRealVertical,this.mapOffContext.save(),this.mapOffContext.translate(this.mapRealHorizontal,0),this.mapOffContext.rotate(45*Config.deg),this.mapOffContext.transform(1,-Math.tan(this.slopeAngle),-Math.tan(this.slopeAngle),1,0,0);for(var k=0;24>k;k++)0===k&&(g.top=360,g.left=360,g.paint(this.mapOffContext)),2===k&&(e.top=360,e.left=240,e.paint(this.mapOffContext)),6===k&&(i.left=0,i.top=360,i.paint(this.mapOffContext)),12===k&&(j.top=0,j.left=0,j.paint(this.mapOffContext)),6>k&&0!==k&&2!==k&&(c.top=360,a.top=360,-1!==this.resumeArr.indexOf(k)?(c.left=60*(6-k),c.paint(this.mapOffContext)):(a.left=60*(6-k),a.paint(this.mapOffContext))),k>6&&12>k&&(d.left=0,b.left=0,-1!==this.resumeArr.indexOf(k)?(d.top=60*(12-k),d.paint(this.mapOffContext)):(b.top=60*(12-k),b.paint(this.mapOffContext))),k>12&&18>k&&(f.top=0,a.top=0,-1!==this.resumeArr.indexOf(k)?(f.left=60*(k-12),f.paint(this.mapOffContext)):(a.left=60*(k-12),a.paint(this.mapOffContext))),k>=18&&24>k&&(h.left=360,b.left=360,-1!==this.resumeArr.indexOf(k)?(h.top=60*(k-18),h.paint(this.mapOffContext)):(b.top=60*(k-18),b.paint(this.mapOffContext)));this.mapOffContext.restore()},drawEnclosure:function(){var a=new Sprite("enclosure-horizontal",new drawStaticImage(Config.imgSource[1],Config.jsonObj.embellish["enclosure-horizontal.png"])),b=new Sprite("enclosure-vertical",new drawStaticImage(Config.imgSource[1],Config.jsonObj.embellish["enclosure-vertical.png"]));this.enclosureVOffCanvas=document.createElement("canvas"),this.enclosureVOffContext=this.enclosureVOffCanvas.getContext("2d"),this.enclosureVOffCanvas.width=15,this.enclosureVOffCanvas.height=680;for(var c=0;4>c;c++)b.top=170*c,b.paint(this.enclosureVOffContext);this.enclosureHOffCanvas=document.createElement("canvas"),this.enclosureHOffContext=this.enclosureHOffCanvas.getContext("2d"),this.enclosureHOffCanvas.width=1056,this.enclosureHOffCanvas.height=30;for(var c=0;8>c;c++)a.left=132*c+11,a.paint(this.enclosureHOffContext)},drawTrees:function(){var a=new Sprite("tree1",new drawStaticImage(Config.imgSource[1],Config.jsonObj.embellish["tree-1.png"])),b=new Sprite("tree2",new drawStaticImage(Config.imgSource[1],Config.jsonObj.embellish["tree-2.png"]));this.tree1OffCanvas=document.createElement("canvas"),this.tree1OffContext=this.tree1OffCanvas.getContext("2d"),this.tree1OffCanvas.width=129,this.tree1OffCanvas.height=124,a.paint(this.tree1OffContext),this.tree2OffCanvas=document.createElement("canvas"),this.tree2OffContext=this.tree2OffCanvas.getContext("2d"),this.tree2OffCanvas.width=160,this.tree2OffCanvas.height=65;for(var c=0;2>c;c++)b.left=95*c,b.paint(this.tree2OffContext)},drawTent:function(){var a=new Sprite("tent",new drawStaticImage(Config.imgSource[1],Config.jsonObj.embellish["tent.png"]));this.tentOffCanvas=document.createElement("canvas"),this.tentOffContext=this.tentOffCanvas.getContext("2d"),this.tentOffCanvas.width=148,this.tentOffCanvas.height=159,a.paint(this.tentOffContext)},drawFireWood:function(){var a=new Sprite("firewood",new drawStaticImage(Config.imgSource[1],Config.jsonObj.embellish["firewood.png"]));this.firewoodOffCanvas=document.createElement("canvas"),this.firewoodOffContext=this.firewoodOffCanvas.getContext("2d"),this.firewoodOffCanvas.width=96,this.firewoodOffCanvas.height=32;for(var b=0;2>b;b++)a.left=64*b,a.paint(this.firewoodOffContext)},drawCask:function(){var a=new Sprite("cask",new drawStaticImage(Config.imgSource[1],Config.jsonObj.embellish["cask.png"]));this.caskOffCanvas=document.createElement("canvas"),this.caskOffContext=this.caskOffCanvas.getContext("2d"),this.caskOffCanvas.width=120,this.caskOffCanvas.height=45;for(var b=0;2>b;b++)a.left=60*b,a.paint(this.caskOffContext)},drawChair:function(){var a=new Sprite("chair",new drawStaticImage(Config.imgSource[1],Config.jsonObj.embellish["chair.PNG"]));this.chairOffCanvas=document.createElement("canvas"),this.chairOffContext=this.chairOffCanvas.getContext("2d"),this.chairOffCanvas.width=128,this.chairOffCanvas.height=64,a.paint(this.chairOffContext)},drawRoles:function(){this.jumper=new Sprite("jumper",new SpriteSheets(Config.imgSource[2],this.findCellData(this.role,Config.jsonObj.jumpers)),this.jumperBehavior),this.jumperOffCanvas=document.createElement("canvas"),this.jumperOffContext=this.jumperOffCanvas.getContext("2d"),this.jumperOffCanvas.width=150,this.jumperOffCanvas.height=150,this.jumper.jumpTimer=new AnimationTimer(this.jumperJumpAniTime),this.jumper.fallTimer=new AnimationTimer(this.jumperJumpAniTime),this.jumper.moveTimer=new AnimationTimer(this.jumperMoveAniTime),this.runner=new Sprite("runner",new SpriteSheets(Config.imgSource[3],this.findCellData(this.role,Config.jsonObj.runners)),this.runnerBehavior),this.runnerOffCanvas=document.createElement("canvas"),this.runnerOffContext=this.runnerOffCanvas.getContext("2d"),this.runnerOffCanvas.width=55,this.runnerOffCanvas.height=80,this.runner.runTimer=new AnimationTimer(this.runnerAniTime)},updateRoles:function(a){"jumper"===this.currentRole?this.drawJumper(a):this.drawRunner(a)},drawJumper:function(a){this.jumper.paint(context),this.jumper.update(context,a)},drawRunner:function(a){this.runner.paint(context),this.runner.update(context,a)},drawElements:function(){this.drawWalkMap(),this.drawEnclosure(),this.drawTrees(),this.drawTent(),this.drawFireWood(),this.drawCask(),this.drawChair(),this.drawRoles()},offScreenCanvasBg:function(){canvasBgContext.drawImage(this.mapOffCanvas,this.walkMapLeft,this.walkMapTop),canvasBgContext.drawImage(this.enclosureVOffCanvas,0,0),canvasBgContext.drawImage(this.enclosureVOffCanvas,this.canvasWidth-15,0),canvasBgContext.drawImage(this.enclosureHOffCanvas,0,0),canvasBgContext.drawImage(this.enclosureHOffCanvas,0,this.canvasHeight-30),canvasBgContext.drawImage(this.tree1OffCanvas,0,0),canvasBgContext.drawImage(this.tree2OffCanvas,this.canvasWidth-190,this.canvasHeight-120),canvasBgContext.drawImage(this.tentOffCanvas,this.canvasWidth-160,0),canvasBgContext.drawImage(this.firewoodOffCanvas,this.canvasWidth-128,160),canvasBgContext.drawImage(this.caskOffCanvas,60,120),canvasBgContext.drawImage(this.chairOffCanvas,50,400)},selectRole:function(a){for(var b=this.roleListAll,c=b.length,d=this,e=0;c>e;e++)!function(c){b[c].addEventListener("click",function(){d.role=this.dataset.role,b[c].className+="",d.currentRole="runner"===d.role?"runner":"jumper",a()},!1)}(e)},showSelectRole:function(){var a=this;this.startGameBtn.addEventListener("click",function(b){b.preventDefault(),a.coverAni(a.gameCover,-560,a.coverSlideTime,gameEasing.easeOut,function(){a.gameCoverWrap.removeChild(a.gameCover),console.log("please select role!!")})},!1)},confirmRoleWH:function(){"runner"===this.role?(this.roleWidth=55,this.roleHeight=80):(this.roleWidth=150,this.roleHeight=150),this.rolesInitialLeft=this.canvasWidth/2-this.roleWidth/2,this.rolesInitialTop=this.walkMapTop+2*this.mapRealVertical-this.roleHeight-this.verticalPacePix,this.rolesHalfLeft=this.rolesInitialLeft,this.rolesHalfTop=this.rolesInitialTop-2*this.mapVertical},showBlackRoom:function(){var a=this;this.entranceBlackRoom=!0,setTimeout(function(){a.gameBlackRoom.className="game-black-room zoomIn animated",a.gameBlackRoom.innerHTML="你真不幸，被关小黑屋啦！想逃离的话，有两种途径：<br />（1）连续掷三次后，自动解除锁定。<br />（2）掷的骰子数相同则自动解除。"},500),setTimeout(function(){a.gameBlackRoom.className="game-black-room hide",a.rollDiceShow(!0)},4500)},showMiniGame:function(){this.miniGameWrap.className="mini-game-wrap zoomIn animated";for(var a=this.pokerList.length,b=["two","three","four","five"],c=this,d=0;a>d;d++)this.pokerList[d].className+=" "+b[Math.floor(4*Math.random())];for(var e=0;a>e;e++)!function(a){c.pokerListBack[a].addEventListener("click",function(){if(!c.pokerSelect){c.pokerSelect=!0;var b=Math.floor(3*Math.random());c.pokerList[b].className="poker-list one",this.className+=" rollOver180",c.pokerList[a].className+=" rollOver0",c.showShortCut(a===b?"success":"fail")}},!1)}(e)},showShortCut:function(a){var b=this;setTimeout(function(){b.pokerTipsWrap.className="poker-tips-wrap zoomIn animated","success"===a?b.showResume("shortCutKey","resume-json/shortCut-key.json",function(a){b.shortCutShowResume(),b.pokerTipsWrap.innerHTML=a.info},!0):b.pokerTipsWrap.innerHTML="你猜错啦,手气不佳呀，下次再来吧！么么哒~"},500),setTimeout(function(){b.rollDiceShow(!0),b.pokerSelect=!1,b.miniGameWrap.className="mini-game-wrap hide",b.pokerTipsWrap.className="poker-tips-wrap hide";for(var a=0;3>a;a++)b.pokerListBack[a].className="poker-list-back",b.pokerList[a].className="poker-list"},3500)},showResult:function(a){var b=this;switch(a){case this.resumeArr[0]:this.showResume("one","resume-json/one.json",function(a){b.resumeOne.call(b,a)});break;case this.resumeArr[1]:this.showResume("two","resume-json/two.json",function(a){b.resumeTwo.call(b,a)});break;case this.resumeArr[2]:this.showResume("three","resume-json/three.json",function(a){b.resumeThree.call(b,a)});break;case this.resumeArr[3]:this.showResume("four","resume-json/four.json",function(a){b.resumeFour.call(b,a)});break;case 2:this.showMiniGame();break;case 6:this.showBlackRoom();break;default:this.rollDiceShow(!0)}},shortCutShowResume:function(){var a=this;document.addEventListener("keydown",function(b){if(!a.shortCutView){a.shortCutView=!0;var c=b.keyCode;switch(c){case 89:a.showResume("one","resume-json/one.json",function(b){a.resumeOne.call(a,b)});break;case 80:a.showResume("two","resume-json/two.json",function(b){a.resumeTwo.call(a,b)});break;case 66:a.showResume("three","resume-json/three.json",function(b){a.resumeThree.call(a,b)});break;case 78:a.showResume("four","resume-json/four.json",function(b){a.resumeFour.call(a,b)});break;default:a.shortCutView=!1}}},!1)},showResume:function(a,b,c,d){var e=this;d||(this.gameResumeDetail.className="game-resume-detail zoomIn animated",this.gameResumeWrap.className="game-resume-wrap loading",this.playSound(this.resumeSound));var f=new XMLHttpRequest||new ActiveXObject("Microsoft.XMLHTTP");f.onreadystatechange=function(){if(4===f.readyState&&(e.gameResumeWrap.className="game-resume-wrap",200===f.status)){var a=JSON.parse(f.responseText);c(a)}},f.open("GET",b,!0),f.setRequestHeader("Content-Type","application/json"),f.send(null)},resumeOne:function(a){var b="<h2>"+a.title+"</h2><p>姓名："+a.name+"</p><p>性别："+a.gender+"</p><p>出生日期："+a.birth+"</p><p>学历："+a.education+"<p>居住地："+a.location+"</p><p>现在所在公司："+a.company+"</p><p>前端开发经验："+a.experience+"</p>";this.gameResumeWrap.innerHTML=b},resumeTwo:function(a){var b="<h2>"+a.title+"</h2><p>手机："+a.mobile+"</p><p>Email："+a.email+"</p><p>QQ："+a.qq+"</p><p>微博："+a.weibo+"</p>";this.gameResumeWrap.innerHTML=b},resumeThree:function(a){var b="<h2>"+a.title+'</h2><p>博客：<a href="'+a.blog+'" target="_blank">点击</a></p><p>GitHub：<a href="'+a.github+'" target="_blank">点击</a></p><p>jQuery解析：<a href="'+a["jquery-analysis"]+'" target="_blank">点击</a></p><p>jQuery插件：<a href="'+a["jquery-plugins"]+'" target="_blank">点击</a><p>本游戏源码：<a href="'+a["resume-game"]+'" target="_blank">点击</a></p><p>HTML5微信页面：<a href="'+a["wifi-update"]+'" target="_blank">点击</a></p><p>PC网站：<a href="'+a["1A"]+'" target="_blank">点击</a></p><p>其它：'+a.soon+"</p>";this.gameResumeWrap.innerHTML=b},resumeFour:function(a){var b="<h2>"+a.title+'</h2><div class="game-work-exp">'+a.info+"</div>";this.gameResumeWrap.innerHTML=b},closeResume:function(){var a=this;this.gameResumeClose.addEventListener("click",function(){a.shortCutView=!1,a.rollDiceShow(!0),this.parentNode.className="game-resume-detail hide",a.gameResumeWrap.innerHTML=""},!1)},soundIsPlaying:function(a){return!a.ended&&a.currentTime>0},playSound:function(a){this.soundIsPlaying(a)?(a.load(),a.play()):a.play()},findCellData:function(a,b){var c=[];for(var d in b)-1!==d.indexOf(a)&&c.push(b[d]);return this.jsonCells[a]=c,c},currentRunnerLoc:function(){this.currentPointer++,25===this.currentPointer&&(this.currentPointer=1)},lastRunnerLoc:function(){this.lastPointer=25!==this.lastPointer?this.lastPointer+this.diceTotal:1},createResumeLoc:function(){for(var a,b=0;4>b;b++)a=Math.floor(24*Math.random()),a%6===0&&a++,-1===this.resumeArr.indexOf(a)&&2!==a?this.resumeArr.push(a):b--},fps:function(a){var b;return b=this.lastFrameTime?1e3/(a-this.lastFrameTime):60,this.lastFrameTime=a,b},showFps:function(){var a=this;this.fpsShow.innerHTML=this.commonFps.toFixed(0)+" fps",setTimeout(function(){a.showFps.call(a)},300)},pauseGame:function(){var a=this;document.addEventListener("keydown",function(b){var c=b.keyCode;32===c&&a.togglePaused()})},togglePaused:function(){var a=+new Date;this.pauseGameTag=!this.pauseGameTag,this.pauseGameTag?this.pauseStartTime=a:this.lastFrameTime+=a-this.pauseStartTime},windowFocus:function(){var a=this;window.onblur=function(){a.pauseGameTag||a.togglePaused()},window.onfocus=function(){a.pauseGameTag&&a.cutDown(2,function(){a.togglePaused()})}},coverAni:function(a,b,c,d,e){var f,g=a.style.top?parseInt(a.style.top):0,h=16,b=parseInt(b),i=Math.abs(b-g),j=i/(c/h),k=1;f=setInterval(function(){var b=(a.style.top?parseInt(a.style.top):0,j*k/i),c=g-j*k*(d(b)/b);return a.style.top=c+"px",k++,b>=1?(clearInterval(f),void e.call(a)):void 0},h)}};var gameEasing={liner:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2},easeInOut:function(a){return a-Math.sin(2*a*Math.PI)/(2*Math.PI)},easeOut:function(a){return 1-Math.pow(1-a,2)},easeIn:function(a){return Math.pow(a,2)}};window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){setTimeout(a,1e3/60)}}();